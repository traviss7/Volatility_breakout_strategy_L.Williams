# 변동성 돌파 전략 백테스트 프로젝트

래리 윌리엄스의 변동성 돌파 전략을 한국 주식 시장에 적용한 체계적 백테스트 및 자동매매 시스템 개발 프로젝트

## 📋 목차
- [프로젝트 개요](#프로젝트-개요)
- [최종 추천 전략](#최종-추천-전략)
- [전략 설명](#전략-설명)
- [개발 환경](#개발-환경)
- [백테스트 결과](#백테스트-결과)
- [과적합 검증](#과적합-검증)
- [파일 구조](#파일-구조)
- [실행 방법](#실행-방법)
- [다음 단계](#다음-단계)

---

## 🎯 프로젝트 개요

**목표:** 변동성 돌파 전략으로 3-5년간 5-10억원 수익 달성

**기간:** 2025년 12월 시작

**최종 전략:**
- 래리 윌리엄스 변동성 돌파 (K=0.5)
- 20일 이동평균선 필터
- 2일 보유 전략
- 7:3 포트폴리오 (전통 70% + 고변동성 30%)

---

## 🏆 최종 추천 전략

### 포트폴리오 구성 (7:3 비율)

**전통 안정 종목 (70%):**
- 네이버 (035420): 35%
- 셀트리온 (068270): 35%

**고변동성 종목 (30%):**
- 알테오젠 (196170): 15%
- 두산에너빌리티 (034020): 15%

### 최종 성과 (20년 백테스트)

| 지표 | 결과 |
|------|------|
| **CAGR** | **53.8%** |
| **MDD** | **-8.3%** |
| **총 수익률** | 16,766% |
| **1천만원 → 20년** | **16억 8천만원** |
| **1억원 → 20년** | **168억 6천만원** |

### 기간별 성과

| 기간 | CAGR | MDD | 1천만원 투자 시 |
|------|------|-----|----------------|
| 3년 | 55.1% | -4.9% | 3,727만원 |
| 5년 | 45.8% | -6.4% | 6,573만원 |
| 10년 | 54.3% | -6.4% | 7억 6,516만원 |
| 20년 | 53.8% | -8.3% | 16억 8,660만원 |

**특징:** 모든 기간에서 CAGR 45-55% 일관적 유지 → **과적합 아님!**

---

## 📊 전략 설명

### 기본 변동성 돌파 전략
```
매수 조건:
1. 당일 고가 >= 당일 시가 + (전일 Range × 0.5)
2. AND 종가 > 20일 이동평균선

매도 조건:
- 2일째 종가 > 20일선이면 → 3일째 시가 매도
- 2일째 종가 < 20일선이면 → 2일째 시가 매도

비용:
- 수수료: 0.03%
- 증권거래세: 0.23%
- 슬리피지: 0.1%
- 총: 0.36%
```

### 핵심 개선 사항

#### 1. 20일선 필터 추가
- 기본 전략: CAGR 13.87% (삼성전자)
- 20일선 추가: CAGR 27.55% (약 2배)
- 승률: 52% → 60%
- MDD: -21% → -9%

#### 2. 2일 보유 전략
| 전략 | 평균 거래 | 평균 CAGR | 평균 MDD |
|------|----------|-----------|----------|
| 1일 보유 | 550회 | 48.8% | -24.5% |
| **2일 보유** | **412회** | **79.2%** | **-18.2%** |

**효과:**
- 거래 25% 감소
- CAGR 62% 증가
- MDD 25% 개선

#### 3. 7:3 포트폴리오
| 구성 | CAGR | MDD | 특징 |
|------|------|-----|------|
| 균등 배분 (25%씩) | 63.0% | -8.4% | 고변동성 중심 |
| **7:3 배분** | **53.8%** | **-8.3%** | **안정성↑** |

---

## 💻 개발 환경

### 필수 프로그램
- Python 3.11.x
- VS Code

### 라이브러리
```bash
pip install finance-datareader pandas numpy openpyxl
```

### 데이터 소스
- FinanceDataReader (한국 주식 데이터)
- 기간: 2005-2025 (약 20년)

---

## 📈 백테스트 결과

### 1단계: 개별 종목 테스트 (1일 보유)

**네이버 (035420)**
- CAGR: 30.84%
- MDD: -16.51%
- 승률: 54.89%

**삼성전자 (005930)**
- CAGR: 27.55%
- MDD: -9.66%
- 승률: 60.25%

### 2단계: 시총 TOP 30 변동성 분석

**변동성 TOP 10 (1/2/3년 평균)**
1. 고려아연: 71.76%
2. 알테오젠: 65.42%
3. 한화오션: 61.07%
4. HD현대일렉트릭: 60.50%
5. 두산에너빌리티: 56.25%

### 3단계: K값 최적화

**K값별 평균 성과 (실전 비용 0.36% 반영)**
- K=0.3: CAGR 42.2%, 거래 823회
- K=0.4: CAGR 35.9%, 거래 706회
- **K=0.5: CAGR 30.3%, 거래 605회** ⭐ 채택
- K=0.6: CAGR 27.6%, 거래 515회
- K=0.7: CAGR 23.2%, 거래 438회

### 4단계: 거래 횟수 감소 전략

| 전략 | 평균 거래 | 평균 CAGR | 효과 |
|------|----------|-----------|------|
| 기본 | 550회 | 51.0% | - |
| 거래량 필터 | 160회 (-71%) | 56.7% | 거래↓ 수익↑ |
| **2일 보유** | **412회 (-25%)** | **79.2%** | **최고** |

### 5단계: 2일 보유 상세 검증

**4종목 비교 (20년)**

| 종목 | 1일 거래 | 1일 CAGR | 2일 거래 | 2일 CAGR | 개선 |
|------|----------|----------|----------|----------|------|
| HD현대중공업 | 276회 | 32.6% | 212회 | 50.9% | +18.3%p |
| 알테오젠 | 681회 | 77.7% | 503회 | 135.5% | +57.9%p |
| 두산에너빌리티 | 680회 | 43.5% | 515회 | 64.0% | +20.6%p |
| HD현대일렉트릭 | 564회 | 41.2% | 420회 | 66.3% | +25.0%p |

---

## 🔍 과적합 검증

### 방법: 기간 분할 테스트

오래된 종목(20년 데이터)으로 전반부/후반부 성과 비교

**결과 (안정적 종목):**

| 종목 | 전반부 CAGR | 후반부 CAGR | 평가 |
|------|------------|------------|------|
| 네이버 | 25.7% | 23.6% | ✅ 안정적 |
| 셀트리온 | 40.8% | 44.9% | ✅ 안정적 |
| SK하이닉스 | 20.9% | 17.2% | ✅ 안정적 |

**결과 (불안정 종목):**

| 종목 | 전반부 | 후반부 | 최근 5년 | 평가 |
|------|--------|--------|----------|------|
| 기아 | 11.0% | 18.9% | 35.0% | ⚠️ 최근 급증 |
| 현대차 | 9.1% | 15.0% | 23.0% | ⚠️ 최근 급증 |

### 7:3 포트폴리오 검증

| 기간 | CAGR | MDD | 평가 |
|------|------|-----|------|
| 3년 | 55.1% | -4.9% | ✅ |
| 5년 | 45.8% | -6.4% | ✅ |
| 10년 | 54.3% | -6.4% | ✅ |
| 20년 | 53.8% | -8.3% | ✅ |

**결론:** 모든 기간에서 45-55% 일관적 → **과적합 아님!**

---

## 📁 파일 구조
```
Vol_Breakout_test/
├── README.md                          # 프로젝트 설명 (본 파일)
├── vol_breakout_test.py               # 메인 백테스트
├── k_optimization_full.py             # K값 최적화
├── reduce_trades.py                   # 거래 감소 전략 테스트
├── verify_2day_strategy.py            # 2일 보유 검증
├── portfolio_2day.py                  # 2일 보유 포트폴리오
├── portfolio_7030.py                  # 7:3 포트폴리오 (최종)
├── portfolio_7030_periods.py          # 기간별 성과
├── test_overfitting.py                # 과적합 검증
├── quarterly_rebalancing.py           # 분기 리밸런싱
├── consistency_check.py               # 종목별 일관성 분석
├── analyze.py                         # 결과 분석
├── verify_trades.py                   # 거래 내역 샘플
├── volatility_ranking.csv             # 변동성 순위
├── backtest_results.csv               # 백테스트 결과
├── k_optimization_results.csv         # K값 최적화 결과
├── strategy_comparison.csv            # 전략 비교
├── portfolio_7030_history.csv         # 7:3 포트폴리오 히스토리
└── rebalancing_history.csv            # 리밸런싱 히스토리
```

---

## 🚀 실행 방법

### 1. 환경 설정
```bash
# Python 3.11 설치 확인
python --version

# 라이브러리 설치
python -m pip install finance-datareader pandas numpy openpyxl
```

### 2. 주요 백테스트 실행
```bash
# 메인 백테스트
py vol_breakout_test.py

# K값 최적화
py k_optimization_full.py

# 2일 보유 검증
py verify_2day_strategy.py

# 7:3 포트폴리오 (최종 추천)
py portfolio_7030.py

# 기간별 성과
py portfolio_7030_periods.py

# 과적합 검증
py test_overfitting.py
```

### 3. 결과 확인
- CSV 파일들을 엑셀로 열어서 확인
- 또는 `analyze.py` 실행

---

## 📊 핵심 발견

### ✅ 성공 요인

**1. 20일선 필터의 위력**
- 거래 횟수 42% 감소
- CAGR 2배 증가
- MDD 절반 감소
- 승률 8%p 증가

**2. 2일 보유 전략**
- 거래 25% 감소
- CAGR 62% 증가
- MDD 25% 개선
- 큰 수익 건을 더 오래 보유

**3. 7:3 포트폴리오**
- 안정 종목으로 리스크 관리
- 고변동성으로 수익 극대화
- MDD -8.3% (매우 안정적)

**4. 과적합 아님**
- 20년 전체 일관적 성과
- 기간별 CAGR 45-55% 유지
- 전반부/후반부 비슷

### ⚠️ 주의사항

**1. 백테스트 한계**
- 과거 성과 ≠ 미래 보장
- 실전 슬리피지 더 클 수 있음
- 심리적 요인 미반영
- **실전 수익률은 백테스트의 70-80% 예상**

**2. 종목 선정**
- 신생 고변동성 종목: 검증 부족
- 전통 안정 종목: 검증 완료
- → 7:3 혼합으로 균형

**3. 거래 비용**
- 연 400-600회 거래
- 비용 12-18% 잠식
- 이미 백테스트에 반영됨

---

## 🎯 목표 달성 시뮬레이션

### 시나리오 1: 1억원 투자

**백테스트 성과 (CAGR 53.8%):**
- 3년: 3억 7,276만원
- 5년: 6억 5,736만원 ✅ 목표 달성!

**현실적 예상 (CAGR 40%, 백테스트의 75%):**
- 3년: 2억 7,440만원
- 5년: 5억 3,782만원 ✅ 목표 달성!

### 시나리오 2: 1천만원 투자

**백테스트 성과:**
- 3년: 3,727만원
- 5년: 6,573만원

**현실적 예상:**
- 3년: 2,744만원
- 5년: 5,378만원

**결론:** 1억원으로 시작하면 5년 내 5-10억 목표 달성 가능!

---

## 💡 실전 전략

### Phase 1: 검증 (1-2개월)
- 모의투자 100만원
- 실제 매매 시뮬레이션
- 심리적 부담 체험
- 백테스트 vs 실전 비교

### Phase 2: 소액 실전 (2-3개월)
- 실전 1천만원
- 슬리피지 실측
- 전략 미세 조정
- 손실 제한 내 운용

### Phase 3: 본격 투자
- 검증 완료 후 1억원
- 7:3 포트폴리오 운용
- 분기별 리밸런싱 고려
- 목표: 5년 내 5-10억

---

## 📝 프로젝트 로그

**2025-12-02**
- 프로젝트 시작
- Python 환경 설정
- 네이버/삼성전자 백테스트
- 20일선 필터 효과 확인

**2025-12-07**
- 시총 TOP 30 변동성 분석
- K값 최적화 완료
- 2일 보유 전략 발견
- 7:3 포트폴리오 구성
- 과적합 검증 완료
- CAGR 53.8% 최종 확정
- GitHub 문서화 완료

**다음 계획**
- 키움증권 OpenAPI 연동
- 자동매매 시스템 개발
- 모의투자 시작

---

## 📚 참고 자료

### 전략 출처
- 래리 윌리엄스, "Long-Term Secrets to Short-Term Trading"
- 강환국, "가상화폐 투자 마법 공식" (절판)

### 학습 내용
- 변동성 돌파 전략 원리
- 추세 필터의 중요성
- 보유기간 최적화
- 포트폴리오 구성 원칙
- 과적합 검증 방법
- 실전 비용 산정

---

## ⚖️ 면책 조항

- 이 프로젝트는 교육 및 연구 목적입니다
- 투자 권유가 아니며, 투자 결과에 대한 책임은 투자자 본인에게 있습니다
- 과거 백테스트 결과가 미래 수익을 보장하지 않습니다
- 실전 투자 전 충분한 검증과 리스크 관리가 필요합니다
- **실전 수익률은 백테스트의 70-80% 수준을 예상해야 합니다**

---

## 📧 Contact

프로젝트 관련 문의: [GitHub Issues]

---

**Last Updated:** 2025-12-07
**Status:** 백테스트 완료, 자동매매 개발 예정
