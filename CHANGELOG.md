# 프로젝트 변경 이력

## 2025-12-10 (화) - Look-ahead Bias 발견 및 수정

### 🔴 중대한 발견: Look-ahead Bias

**문제 발견:**
매수 조건에서 `당일 종가 > 20일선` 조건 사용
- 당일 종가는 장 마감 후에만 알 수 있음
- 실전에서 불가능한 조건
- 백테스트 결과가 과대평가됨

**수정:**
```python
# 기존 (잘못)
df['signal'] = (df['High'] >= df['target']) & (df['Close'] > df['MA20'])

# 수정 (올바름)
df['signal'] = (df['High'] >= df['target']) & (df['Close'].shift(1) > df['MA20'].shift(1))
```

### 📊 수정 전후 비교

#### 7:3 포트폴리오 (네이버, 셀트리온, 알테오젠, 두산에너빌리티)

| 항목 | 수정 전 | 수정 후 | 변화 |
|------|---------|---------|------|
| CAGR | 53.8% | **14.6%** | -39.2%p |
| MDD | -8.3% | **-16.0%** | -7.7%p |
| 20년 수익 | 16억 | **5천만원** | -94% |

**충격적 결과:** Look-ahead bias가 성과의 73%를 차지했음!

#### 개별 종목 (2일 보유, 20일선 필터)

| 종목 | 1일 CAGR | 2일 CAGR | MDD |
|------|----------|----------|-----|
| HD현대중공업 | -9.4% | -0.6% | -31.8% |
| 알테오젠 | 12.9% | 36.2% | -33.0% |
| 두산에너빌리티 | 14.3% | 28.8% | -50.7% |
| HD현대일렉트릭 | 7.9% | 20.1% | -42.4% |
| **평균** | **6.4%** | **21.1%** | **-39.5%** |

- 2일 보유는 여전히 효과적 (3배 증가)
- 하지만 전반적으로 낮은 성과

#### 기간별 성과 (7:3 포트폴리오)

| 기간 | CAGR | MDD | 1천만원 투자 시 |
|------|------|-----|----------------|
| 3년 | 7.5% | -13.7% | 1,242만원 |
| 5년 | 6.8% | -16.0% | 1,388만원 |
| 10년 | 16.1% | -16.0% | 4,423만원 |
| 전체 | 14.2% | -16.0% | 5,054만원 |

### 🧪 원본 전략 검증 (필터 없음)

#### 한국 주식 (네이버, 셀트리온, 삼성전자, SK하이닉스)

| 종목 | 거래 | 승률 | CAGR | MDD |
|------|------|------|------|-----|
| 네이버 | 1,258회 | 40.0% | NaN | -100.1% |
| 셀트리온 | 1,216회 | 45.7% | 21.4% | -66.3% |
| 삼성전자 | 1,260회 | 42.6% | -36.6% | -91.5% |
| SK하이닉스 | 1,258회 | 47.9% | -10.9% | -78.3% |
| **평균** | **1,248회** | **44.1%** | **-8.7%** | **-84.0%** |

**결론:** 원본 전략은 한국 시장에서 실패

#### 미국 주식 (변동성 TOP 10)

**변동성 순위:**
1. TSLA: 63.24%
2. AVGO: 52.90%
3. NVDA: 50.17%
4. META: 38.48%
5. NKE: 37.08%

**원본 전략 (필터 없음):**

| 종목 | 거래 | 승률 | CAGR | MDD |
|------|------|------|------|-----|
| TSLA | 1,056회 | 50.2% | 18.1% | -53.1% |
| AVGO | 1,069회 | 43.9% | -19.9% | -90.8% |
| NVDA | 1,043회 | 52.0% | 4.3% | -59.1% |
| META | 1,097회 | 42.2% | -28.5% | -97.1% |
| **평균** | **1,080회** | **44.1%** | **-19.3%** | **-85.8%** |

**20일선 필터 추가 (2일 보유):**

| 종목 | 거래 | 승률 | CAGR | MDD |
|------|------|------|------|-----|
| TSLA | 430회 | 53.5% | 25.1% | -48.2% |
| NVDA | 509회 | 54.8% | 13.0% | -40.4% |
| AMZN | 460회 | 50.4% | 1.1% | -26.8% |
| AAPL | 539회 | 50.8% | 1.4% | -45.8% |
| **평균** | **481회** | **47.8%** | **-2.6%** | **-60.9%** |

**결론:** 미국도 마찬가지로 실패

### 💡 핵심 발견

1. **Look-ahead Bias의 파괴력**
   - 잘못된 조건 하나로 성과가 4배 과장됨
   - 실전 불가능한 백테스트는 무의미

2. **20일선 필터는 필수**
   - 필터 없으면: CAGR -19%
   - 필터 추가: CAGR -2.6% (개선되지만 여전히 부족)

3. **2일 보유는 효과적**
   - 1일 대비 3배 수익 증가
   - 거래 25% 감소

4. **원본 전략의 한계**
   - 1987년 선물 시장용
   - 현대 현물 시장엔 부적합
   - 한국/미국 모두 실패

### 📝 새로 추가된 파일
```
us_stock_analysis.py          # 미국 주식 변동성 분석
original_larry.py              # 한국 원본 전략
original_larry_us_top10.py     # 미국 원본 전략
us_with_ma20.py                # 미국 20일선 필터
us_volatility_ranking.csv      # 미국 변동성 순위
us_original_results.csv        # 미국 원본 결과
us_ma20_results.csv            # 미국 20일선 결과
```

### 🔧 수정된 파일 (Look-ahead Bias 제거)

- `portfolio_7030.py`
- `portfolio_7030_periods.py`
- `verify_2day_strategy.py`
- `test_overfitting.py`
- 기타 모든 백테스트 파일

### 🤔 현재 상황

**긍정적:**
- Look-ahead bias 발견하고 수정 완료
- 올바른 백테스트 방법론 확립
- 2일 보유 전략 검증 완료

**부정적:**
- CAGR 14.6% (목표 달성 어려움)
- MDD -16% (리스크 높음)
- 변동성 돌파 전략 자체의 한계 확인

### 🎯 다음 단계 (검토 필요)

1. **전략 재설계**
   - 다른 진입 조건 탐색
   - 복합 필터 추가
   - 보유기간 조정

2. **다른 전략 고려**
   - 평균회귀 전략
   - 모멘텀 전략
   - 결합 전략

3. **현실적 목표 재설정**
   - CAGR 10-15% 수준 목표
   - 안정성 우선 (MDD -10% 이내)

---

## 2025-12-07 - 백테스트 완료 (Look-ahead Bias 있음)

초기 백테스트 결과 (현재 무효):
- 7:3 포트폴리오: CAGR 53.8%
- 과적합 검증 완료
- GitHub 문서화

---

**Last Updated:** 2025-12-10
**Status:** 전략 재검토 필요